<!doctype html>
<html lang="en">
  <head>
     <link rel="stylesheet" href="http://openlayers.org/en/v3.1.1/css/ol.css" type="text/css">
     <style>
     .map {
        height: 600px;
        width: 100%;
      }
      </style>
      <script src="http://openlayers.org/en/v3.1.1/build/ol.js" type="text/javascript"></script>
      <title>Faremeldingere</title>
  </head>
  <body>
   <h2>Warnings:</h2>
   <div id="map" class="map"></div>
   <div id="info" class="alert alert-success">
            &nbsp;
   </div>
   <p>Click on areas for details.  Date given is VALID TO for warnings</p>
   <script type="text/javascript">

   var projection = ol.proj.get('EPSG:3857');

   var galeStyleFunction = function(feature, resolution) {
		   var R = 0;
		   var G = 185;
		   var B = 255;
		   var opacity = 0.7;
		   var stro = '#ffffff';
		   var wi = 1.25;

		   return [ new ol.style.Style({
             fill: new ol.style.Fill({
					 color: [R,G,B,opacity]
			 }),
  	         stroke: new ol.style.Stroke({
					 color: stro,
					 width: wi,
					 opacity: opacity
			 })
	     }),
   		 ];
   };

   var ekstremeStyleFunction = function(feature, resolution) {
		   var R = 255;
		   var G = 0;
		   var B = 0;
		   var opacity = 0.3;
		   var stro = '#ffffff';
		   var wi = 1.25;

		   return [ new ol.style.Style({
             fill: new ol.style.Fill({
					 color: [R,G,B,opacity]
			 }),
  	         stroke: new ol.style.Stroke({
					 color: stro,
					 width: wi,
					 opacity: opacity
			 })
	     }),
   		 ];
   };

   var obsStyleFunction = function(feature, resolution) {
		   var R = 0;
		   var G = 200;
		   var B = 0;
		   var opacity = 0.5;
		   var stro = '#ffffff';
		   var wi = 1.25;

		   return [ new ol.style.Style({
             fill: new ol.style.Fill({
					 color: [R,G,B,opacity]
			 }),
  	         stroke: new ol.style.Stroke({
					 color: stro,
					 width: wi,
					 opacity: opacity
			 })
	     }),
   		 ];
   };

   var gale = new ol.layer.Vector({
		   source: new ol.source.KML({
		       extractStyles: false,
			   projection: projection,
			   url: 'data/Current_gale_ol.kml'
		   }),
		   style: galeStyleFunction
   });
   
   var obs = new ol.layer.Vector({
		   source: new ol.source.KML({
		       extractStyles: false,
			   projection: projection,
			   url: 'data/Current_obs_ol.kml'
		   }),
		   style: obsStyleFunction
   });
   
   var extreme = new ol.layer.Vector({
		   source: new ol.source.KML({
		       extractStyles: false,
			   projection: projection,
			   url: 'data/Current_extreme_ol.kml'
		   }),
		   style: ekstremeStyleFunction
   });


   var raster =  new ol.layer.Tile({
		  source: new ol.source.OSM()
		});

   var map = new ol.Map({
     target: 'map',
     layers: [ raster, gale, obs, extreme ],
     view: new ol.View({
	 	projection: projection,
        center: ol.proj.transform([15.00, 65.00], 'EPSG:4326', 'EPSG:3857'),
        zoom: 4
      })
    });
    
	var displayFeatureInfo = function(pixel) {
	  var features = [];
	  map.forEachFeatureAtPixel(pixel, function(feature, layer) {
		features.push(feature);
	  });
	  if (features.length > 0) {
		var info = [];
		var i, ii;
		for (i = 0, ii = features.length; i < ii; ++i) {
		  info.push(features[i].get('name')+" "+features[i].get('description'));
		}
		document.getElementById('info').innerHTML = info.join('<p>   ') || '(unknown)';
		map.getTarget().style.cursor = 'pointer';
	  } else {
		document.getElementById('info').innerHTML = '&nbsp;';
		map.getTarget().style.cursor = '';
	  }
	};

	map.on('click', function(evt) {
 	 displayFeatureInfo(evt.pixel);
	});
	
    </script>
  </body>
</html>
